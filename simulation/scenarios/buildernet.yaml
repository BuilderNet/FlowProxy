general:
  # Stop after 13 minutes (simulated time)
  # This should be enough to submit all the bundles in the testdata.parquet file, so will depend on the
  # time range defined there. IMPORTANT: Update this if the time range changes, and add a small buffer (3m).
  stop_time: 5m
  # Show progress in the console
  progress: true
  # Add some latency to syscalls to avoid deadlocks
  model_unblocked_syscall_latency: true
  # The seed to use to generate randomness. It is reported the default value just for clarity.
  seed: 1

experimental:
  # Pin the CPU to the same core for better performance
  use_cpu_pinning: true
  # Use the new Rust TCP implementation for better performance
  use_new_tcp: true

# Intra-zone latencies: https://latency.azure.cloud63.fr
# Inter-zone latencies: https://learn.microsoft.com/en-us/azure/networking/azure-network-latency
network:
  graph:
    type: gml
    file:
      path: /root/scenarios/network-graph-2-zones.yaml

hosts:
  hub:
    network_node_id: 0
    ip_addr: 10.0.0.1
    processes:
    - path: /root/mockhub
      start_time: 0s
      expected_final_state: running
      environment:
        # System API ports of the proxies
        SYSTEM_PORT: "5544"
  submitter:
    # Run the submitter in zone 0
    network_node_id: 0
    ip_addr: 10.0.0.2
    processes:
    - path: /root/submitter
      args: --url http://proxy1:9754 --path ../../../testdata/testdata.parquet --scale 5
      # Wait 35s for the proxies to connect to each other
      start_time: 35s
      expected_final_state: { exited: 0 }
  proxy1:
    network_node_id: 0
    ip_addr: 10.0.0.3
    host_options:
      pcap_enabled: true
      # Shadow by default writes to disk the whole content of an IP packet to the PCAP. We clearly don't want that bloat,
      # we mainly care about metadata. 20 bytes represents minimum IPv4 header size.
      pcap_capture_size: 20
    processes:
    - path: /root/buildernet-orderflow-proxy
      args: --user-listen-url 0.0.0.0:9754 --system-listen-url 0.0.0.0:5544 --builder-listen-url 0.0.0.0:8756 --builder-hub-url http://hub:3000 --indexer.parquet.bundle-receipts-file-path bundle_receipts_proxy1.parquet --builder-name proxy1
      start_time: 1s
      shutdown_time: 4m
      expected_final_state: { exited: 0 }
      environment:
        RUST_LOG: buildernet_orderflow_proxy=info,ingress=info,forwarder=info
  proxy2:
    network_node_id: 1
    ip_addr: 10.0.0.4
    host_options:
      pcap_enabled: true
      # Shadow by default writes to disk the whole content of an IP packet to the PCAP. We clearly don't want that bloat,
      # we mainly care about metadata. 20 bytes represents minimum IPv4 header size.
      pcap_capture_size: 20
    processes:
    - path: /root/buildernet-orderflow-proxy
      args: --user-listen-url 0.0.0.0:9754 --system-listen-url 0.0.0.0:5544 --builder-listen-url 0.0.0.0:8756 --builder-hub-url http://hub:3000 --indexer.parquet.bundle-receipts-file-path bundle_receipts_proxy2.parquet --builder-name proxy2
      shutdown_time: 4m
      expected_final_state: { exited: 0 }
      environment:
        RUST_LOG: buildernet_orderflow_proxy=info,ingress=info,forwarder=info
